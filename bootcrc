#!/bin/bash
# bootc version check - notify user if update is available

# Path to the version file
VERSION_FILE="$HOME/git/f-bootc-ws/bootc_version.txt"

# Check if version file exists
if [[ ! -f "$VERSION_FILE" ]]; then
    return 0
fi

# Read the upstream version
UPSTREAM_VERSION=$(cat "$VERSION_FILE" 2>/dev/null | tr -d '[:space:]')
if [[ -z "$UPSTREAM_VERSION" ]]; then
    return 0
fi

# Get current running version from rpm-ostree
CURRENT_VERSION=$(rpm-ostree status 2>/dev/null | grep -m1 "Version:" | awk '{print $2}')

# Remove any trailing data after version number (like timestamps)
CURRENT_VERSION=$(echo "$CURRENT_VERSION" | tr -d '[:space:]')

# If we couldn't get current version, exit silently
if [[ -z "$CURRENT_VERSION" ]]; then
    return 0
fi

# Compare versions - if they differ, notify user
if [[ "$CURRENT_VERSION" != "$UPSTREAM_VERSION" ]]; then
    echo -e "\e[0;31mNew bootc version ($UPSTREAM_VERSION) available. Run: sudo rpm-ostree update\e[0m"
fi
